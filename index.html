<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>公共资源站</title>
</head>
<body bgcolor="#A8E6CF">
    <h1>公共资源站</h1>
    
    <div>
        <div>
            <input type="text" id="searchInput" placeholder="输入序号查找" size="15">
            <button onclick="searchResource()">查找</button>
            <button onclick="showAll()">显示全部</button>
            <button onclick="loadResources()">刷新</button>
            <button onclick="window.location.href='upload.html'">上传资源</button>
        </div>
    </div>
    
    <div id="resource-list">
        <p>正在加载...</p>
    </div>

    <script src="resource.js"></script>
    
    <script>
        let allResources = [];
        
        function loadAllResources() {
            if (typeof resources === 'undefined' || !Array.isArray(resources) || resources.length === 0) {
                allResources = [];
                return false;
            }
            
            allResources = resources.slice();
            return true;
        }
        
        function loadResources() {
            if (!loadAllResources()) {
                document.getElementById('resource-list').innerHTML = '<p>无！</p>';
                return;
            }
            
            displayResources(allResources);
        }
        
        function displayResources(resourceArray) {
            const resourceList = document.getElementById('resource-list');
            
            if (!resourceArray || resourceArray.length === 0) {
                resourceList.innerHTML = '<p>无！</p>';
                return;
            }
            
            let html = '<table border="1" cellpadding="10" cellspacing="0" width="100%">';
            html += '<thead><tr><th width="10%">序号</th><th width="40%">文件名</th><th width="15%">大小</th><th width="25%">发布者/发布时间</th><th width="10%">描述</th></tr></thead>';
            html += '<tbody>';
            
            resourceArray.forEach(function(resource) {
                const publisher = resource.publisher ? resource.publisher : '无！';
                const publishDate = resource.publishDate ? resource.publishDate : '无！';
                html += `<tr>`;
                html += `<td align="center"><b>${resource.id}</b></td>`;
                html += `<td><a href="${resource.link}" target="_blank"><b>${resource.name}</b></a></td>`;
                html += `<td align="center">${resource.size}</td>`;
                html += `<td align="center"><small>${publisher}<br>${publishDate}</small></td>`;
                html += `<td>${resource.description || '-'}</td>`;
                html += `</tr>`;
            });
            
            html += '</tbody></table>';
            
            resourceList.innerHTML = html;
        }
        
        function searchResource() {
            const searchInput = document.getElementById('searchInput');
            const inputValue = searchInput.value.trim();
            
            if (!inputValue) {
                alert("请输入序号！");
                return;
            }
            
            const searchId = parseInt(inputValue);
            if (isNaN(searchId)) {
                alert("序号必须是数字！");
                return;
            }
            
            if (!loadAllResources()) {
                document.getElementById('resource-list').innerHTML = '<p>加载失败...</p>';
                return;
            }
            
            const foundResources = allResources.filter(resource => resource.id === searchId);
            
            if (foundResources.length === 0) {
                document.getElementById('resource-list').innerHTML = '<p><b>无！</b></p>';
            } else {
                displayResources(foundResources);
            }
        }
        
        function showAll() {
            loadResources();
            document.getElementById('searchInput').value = '';
        }
        
        window.onload = loadResources;
    </script>
</body>
</html>